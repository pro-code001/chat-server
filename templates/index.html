<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Two-Person Chat App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 500px;
      margin: 30px auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    input {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
    }
    button {
      padding: 10px;
      width: 100%;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }
    #chat {
      display: none;
    }
    #messages {
      height: 300px;
      border: 1px solid #ccc;
      padding: 10px;
      overflow-y: auto;
      background-color: #fafafa;
      margin-bottom: 10px;
    }
    p {
      margin: 5px 0;
    }
  </style>
</head>
<body>

<div class="container" id="auth">
  <h2>Login or Sign Up</h2>
  <input type="text" id="authUsername" placeholder="Username" />
  <input type="password" id="authPassword" placeholder="Password" />
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Log In</button>
</div>

<div class="container" id="roomForm" style="display: none;">
  <h2>Create or Join a Room</h2>
  <input type="text" id="roomNameInput" placeholder="Room Name" />
  <input type="password" id="roomPasswordInput" placeholder="Room Password" />
  <button id="createRoomBtn">Create Room</button>
  <button id="joinRoomBtn">Join Room</button>
</div>

<div class="container" id="chat">
  <h2>Room: <span id="roomDisplayName"></span></h2>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Type your message..." />
  <button id="sendBtn">Send</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const authDiv = document.getElementById('auth');
  const roomFormDiv = document.getElementById('roomForm');
  const chatDiv = document.getElementById('chat');

  const authUsernameInput = document.getElementById('authUsername');
  const authPasswordInput = document.getElementById('authPassword');
  const signupBtn = document.getElementById('signupBtn');
  const loginBtn = document.getElementById('loginBtn');

  const roomNameInput = document.getElementById('roomNameInput');
  const roomPasswordInput = document.getElementById('roomPasswordInput');
  const createRoomBtn = document.getElementById('createRoomBtn');
  const joinRoomBtn = document.getElementById('joinRoomBtn');

  const roomDisplayName = document.getElementById('roomDisplayName');
  const messagesDiv = document.getElementById('messages');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');

  let currentUsername = null;
  let currentRoom = null;

  signupBtn.onclick = () => {
    const username = authUsernameInput.value.trim();
    const password = authPasswordInput.value.trim();
    if (!username || !password) {
      alert("Enter username and password to sign up.");
      return;
    }
    socket.emit('signup', { username, password });
  };

  loginBtn.onclick = () => {
    const username = authUsernameInput.value.trim();
    const password = authPasswordInput.value.trim();
    if (!username || !password) {
      alert("Enter username and password to log in.");
      return;
    }
    socket.emit('login', { username, password });
  };

  socket.on('signup_response', data => {
    alert(data.msg);
    if (data.success) {
      currentUsername = authUsernameInput.value.trim();
      authDiv.style.display = 'none';
      roomFormDiv.style.display = 'block';
    }
  });

  socket.on('login_response', data => {
    alert(data.msg);
    if (data.success) {
      currentUsername = authUsernameInput.value.trim();
      authDiv.style.display = 'none';
      roomFormDiv.style.display = 'block';
    }
  });

  createRoomBtn.onclick = () => {
    const room = roomNameInput.value.trim();
    const password = roomPasswordInput.value.trim();
    if (!room || !password) {
      alert("Enter room name and password.");
      return;
    }
    socket.emit('create', { username: currentUsername, room, password });
  };

  joinRoomBtn.onclick = () => {
    const room = roomNameInput.value.trim();
    const password = roomPasswordInput.value.trim();
    if (!room || !password) {
      alert("Enter room name and password.");
      return;
    }
    socket.emit('join', { username: currentUsername, room, password });
  };

  socket.on('created', data => {
    enterChatRoom(data.room);
    alert("Room created and joined: " + data.room);
  });

  socket.on('joined', data => {
    enterChatRoom(data.room);
    alert("Joined room: " + data.room);
  });

  socket.on('error', data => {
    alert(data.msg);
  });

  function enterChatRoom(room) {
    currentRoom = room;
    roomFormDiv.style.display = 'none';
    chatDiv.style.display = 'block';
    roomDisplayName.textContent = room;
    messagesDiv.innerHTML = '';
  }

  sendBtn.onclick = () => {
    const msg = messageInput.value.trim();
    if (!msg) return;
    socket.emit('message', {
      username: currentUsername,
      room: currentRoom,
      msg
    });
    messageInput.value = '';
  };

  socket.on('message', data => {
    if (data.room === currentRoom) {
      const p = document.createElement('p');
      p.textContent = `${data.username}: ${data.msg}`;
      messagesDiv.appendChild(p);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  });
</script>
</body>
</html>
